function updateHTML(){return $.ajax("/",{success:function(){serverOnline=!0},error:function(){serverOnline=!1}}),serverOnline?($("#server-status").text("Factomd Running"),void($("#indexnav-main").hasClass("is-active")?(updateHeight(),updateAllPeers(),skipInterval?skipInterval=!1:(updateTransactions(),skipInterval=!0)):$("#indexnav-more").hasClass("is-active")&&updataDataDumps())):void $("#server-status").text("Factomd Not Running")}function updataDataDumps(){resp=queryState("dataDump","",function(a){obj=JSON.parse(a),$("#dump1 #dumpShort").text(obj.DataDump1.ShortDump),$("#dump1 #dumpRaw").text(obj.DataDump1.RawDump),$("#dump2 #dumpRaw").text(obj.DataDump2.RawDump),$("#dump3 #dumpRaw").text(obj.DataDump3.RawDump),$("#dump4 #dumpAuth").text(obj.DataDump4.Authorities),$("#dump4 #dumpIdent").text(obj.DataDump4.Identities),$("#dump4 #dumpMyNode").text(obj.DataDump4.MyNode),$("#dump5 #dumpConRaw").text(obj.DataDump5.RawDump),$("#dump5 #dumpSort").text(obj.DataDump5.SortedDump)})}function updateTransactions(){resp=queryState("recentTransactions","",function(a){obj=JSON.parse(a),$("#DBKeyMR > a").text(obj.DirectoryBlock.KeyMR),$("#DBBodyKeyMR").text(obj.DirectoryBlock.BodyKeyMR),$("#DBFullHash").text(obj.DirectoryBlock.FullHash),$("#DBBlockHeight").text(obj.DirectoryBlock.DBHeight),$("#recent-directory-block").text(obj.DirectoryBlock.DBHeight),null!=obj.FactoidTransactions&&obj.FactoidTransactions.forEach(function(a){a.TotalInput>1e-4&&($("#panFactoids > #traxList > tbody #"+a.TxID).length>0||($("#panFactoids > #traxList > tbody").prepend("              <tr id='"+a.TxID+"'>                  <td><a id='factom-search-link' type='factoidack'>"+a.TxID+"</a></td>                  <td>"+a.TotalInput+"</td>                  <td>"+a.TotalInputs+"</td>                  <td>"+a.TotalOutputs+"</td>              </tr>"),$("#panFactoids > #traxList > tbody > tr").length>100&&$("#panFactoids > #traxList > tbody >tr").last().remove()))}),null!=obj.Entries&&obj.Entries.forEach(function(a){$("#recent-entry-total").text("("+$("#panEntries > #traxList > tbody > tr").length+")"),$("#panEntries #"+a.Hash).length>0?($("#"+a.Hash+" #chainID a").text()!=a.ChainID&&$("#"+a.Hash+" #chainID a").text(a.ChainID),"Processing"!=$("#"+a.Hash+" #chainID a").text()&&$("#"+a.Hash+" #entry-entryhash a").attr("type","entry"),$("#"+a.Hash+" #eccost").text()!=a.ECCost&&$("#"+a.Hash+" #eccost").text(a.ECCost)):($("#panEntries > #traxList > tbody").prepend("            <tr id='"+a.Hash+"'>                <td id='entry-entryhash'><a id='factom-search-link' type='entryack'>"+a.Hash+"</a></td>                <td id='chainID'><a id='factom-search-link' type='chainhead'>"+a.ChainID+"</a></td>                <td id='eccost'>"+a.ECCost+"</td>            </tr>"),$("#panEntries > #traxList > tbody > tr").length>100&&$("#panEntries > #traxList > tbody >tr").last().remove())}),$("#recent-factoid-total").text("("+$("#panFactoids > #traxList > tbody > tr").length+")")})}function updateHeight(){resp=batchQueryState("myHeight,leaderHeight,completeHeight,servercount,channelLength",function(a){obj=JSON.parse(a),myHeight=obj[0].Height,lHeight=obj[1].Height,compHeight=obj[2].Height,feds=obj[3].fed,auds=obj[3].aud,respFive=obj[4].length,$("#serverfedcount").val(feds),$("#serveraudcount").val(auds),currentHeight=parseInt(myHeight),$("#nodeHeight").val(myHeight),leaderHeight=parseInt(lHeight),updateProgressBar("#syncFirst > .progress-meter",currentHeight,leaderHeight),percent=0,0==leaderHeight?percent=100:(percent=currentHeight/leaderHeight*100,percent=Math.floor(percent)),$("#syncFirst > .progress-meter > .progress-meter-text").text(percent+"% Synced ("+currentHeight+" of "+leaderHeight+")"),completeHeight=parseInt(compHeight),updateProgressBar("#syncSecond > .progress-meter",completeHeight,leaderHeight),percent=completeHeight/leaderHeight*100,percent=Math.floor(percent),$("#syncSecond > .progress-meter > .progress-meter-text").text(completeHeight+" of "+leaderHeight)})}function updateProgressBar(a,b,c){0==c?(percent=b/c*100,$(a).width("100%")):(percent=b/c*100,$(a).width(percent+"%"))}function updateAllPeers(){batchQueryState("peerTotals,peers",function(a){if(obj=JSON.parse(a),respOne=obj[0],resp=obj[1],$("#totalPeerCount").text(resp.length),0!=respOne.length){if("undefined"==typeof respOne||($("#peerList > tfoot > tr > #up").text(formatBytes(respOne.BytesSentTotal,respOne.MessagesSent)),$("#peerList > tfoot > tr > #down").text(formatBytes(respOne.BytesReceivedTotal,respOne.MessagesReceived))),0==resp.length)return void $("#peerList tbody tr").each(function(){jQuery(this).remove()});peerHashes=[""],newPeers=0;for(index in resp)peer=resp[index],peerHashes.push(peer.PeerHash),$("#"+peer.Hash).length>0?(con=peer.Connection,$("#"+peer.Hash).find("#ip").val()!=peer.PeerHash&&($("#"+peer.Hash).find("#ip span").text(con.PeerAddress),$("#"+peer.Hash).find("#ip").val(peer.PeerHash),$("#"+peer.Hash).find("#disconnect").attr("value",peer.PeerHash),$("#"+peer.Hash).foundation()),$("#"+peer.Hash).find("#ip span").attr("title")!=con.ConnectionNotes&&(element=$("#"+peer.Hash).find("#ip span"),wich=$("has-tip").index(element),$(".tooltip").eq(wich).html(con.ConnectionNotes)),$("#"+peer.Hash).find("#connected").val()!=con.ConnectionState&&($("#"+peer.Hash).find("#connected").val(con.ConnectionState),$("#"+peer.Hash).find("#connected").text(con.ConnectionState),0==peer.Connected&&$("#peerList > tbody").find("#"+peer.Hash).remove()),$("#"+peer.Hash).find("#peerquality").val()!=con.PeerQuality&&($("#"+peer.Hash).find("#peerquality").val(con.PeerQuality),$("#"+peer.Hash).hasClass(formatQuality(con.PeerQuality))||($("#"+peer.Hash).removeClass(),$("#"+peer.Hash).addClass(formatQuality(con.PeerQuality)))),0!=$("#"+peer.Hash).find("#sent").val().length&&$("#"+peer.Hash).find("#sent").val()==con.BytesSent||($("#"+peer.Hash).find("#sent").val(con.BytesSent),$("#"+peer.Hash).find("#sent").text(formatBytes(con.BytesSent,con.MessagesSent))),0!=$("#"+peer.Hash).find("#received").val().length&&$("#"+peer.Hash).find("#received").val()==con.BytesReceived||($("#"+peer.Hash).find("#received").val(con.BytesReceived),$("#"+peer.Hash).find("#received").text(formatBytes(con.BytesReceived,con.MessagesReceived))),$("#"+peer.Hash).find("#momentconnected").val()!=peer.ConnectionTimeFormatted&&($("#"+peer.Hash).find("#momentconnected").val(peer.ConnectionTimeFormatted),$("#"+peer.Hash).find("#momentconnected").text(peer.ConnectionTimeFormatted))):(newPeers+=1,newPeers<20&&(0==PeerAddFromTopToggle?$("#peerList > tbody").prepend("              <tr id='"+peer.Hash+"'>                  <td id='ip'><span data-tooltip class='has-tip top' title=''>Loading...</span></td>                  <td id='connected'></td>                  <td id='peerquality'></td>                  <td id='momentconnected'></td>                  <td id='sent' value='-10'></td>                  <td id='received' value='-10'></td>                  <td><a id='disconnect' class='button tiny alert'>Disconnect</a></td>              </tr>"):$("#peerList > tbody").append("              <tr id='"+peer.Hash+"'>                  <td id='ip'><span data-tooltip class='has-tip top' title=''>Loading...</span></td>                  <td id='connected'></td>                  <td id='peerquality'></td>                  <td id='momentconnected'></td>                  <td id='sent' value='-10'></td>                  <td id='received' value='-10'></td>                  <td><a id='disconnect' class='button tiny alert'>Disconnect</a></td>              </tr>")));$("#peerList tbody tr").each(function(){jQuery(this).find("#ip span").text().includes("Loading")?"Loading...."==jQuery(this).find("#ip span").text()?jQuery(this).remove():jQuery(this).find("#ip span").text("Loading...."):contains(peerHashes,jQuery(this).find("#ip").val())||jQuery(this).remove()})}})}function generalSort(a,b,c){for(1==SortToggle?SortToggle=!1:SortToggle=!0,peerLen=c.length,index=0;index<peerLen;index++){if(tmpVal=c[index],tmp=b[index],1==SortToggle)for(j=index-1;j>-1&&!a(c[j].innerText,tmpVal.innerText);j--)c[j+1]=c[j],b[j+1]=b[j];else for(j=index-1;j>-1&&a(c[j].innerText,tmpVal.innerText);j--)c[j+1]=c[j],b[j+1]=b[j];c[j+1]=tmpVal,b[j+1]=tmp}return b}function msgIsLessThan(a,b){return"string"!=typeof a||"string"!=typeof b?0:0==a.length||0==b.length?0:(aSplit=a.split("("),aData=aSplit[1].split(" "),aVal=convertToBytes(aData[0],aData[1]),bSplit=b.split("("),bData=bSplit[1].split(" "),bVal=convertToBytes(bData[0],bData[1]),aVal<bVal?1:0)}function ipIsLessThan(a,b){if("string"!=typeof a||"string"!=typeof b)return-1;if(a.split("."),b.split("."),aLen=a.length,bLen=b.length,aLen<bLen)return 1;for(i=0;i<aLen;i++){if("NaN"==Number(b[i]))return 1;if("NaN"==Number(a[i]))return 0;if(Number(a[i])<Number(b[i]))return 1;if(Number(a[i])>Number(b[i]))return 0}}function durationIsLessThan(a,b){return aSec=convertToSeconds(a),bSec=convertToSeconds(b),aSec==-1||bSec==-1?-1:aSec<=bSec?1:0}function convertToSeconds(a){if("string"!=typeof a)return-1;var b=a.split(" ");return b.length<2?-1:(b[0]++,b[1].includes("sec")?1*b[0]:b[1].includes("min")?60*b[0]:b[1].includes("hr")?3600*b[0]:b[1].includes("day")?86400*b[0]:void 0)}function convertToBytes(a,b){return b.includes("KB")?1e3*a:b.includes("MB")?1e6*a:b.includes("GB")?1e6*a:void 0}function contains(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}function getIPCountry(a){}function formatQuality(a){return a>=100?"rank-green":a>=-50?"rank-gold":"rank-red"}function formatBytes(a,c){return void 0==a||void 0==c?"0 (0 Kb)":(b=Number(a/1e3).toFixed(1),b<100?b+=" KB":a/1e6<100?(b=Number(a/1e6).toFixed(1),b+=" MB"):(b=Number(a/1e9).toFixed(1),b+=" GB"),m=c,m>1e3&&(m=Number(c/1e3).toFixed(1),m+=" K"),m+"("+b+")")}var currentHeight=0,leaderHeight=0;setInterval(updateHTML,3e3);var serverOnline=!1,skipInterval=!1;$(window).load(function(){updateHTML(),setTimeout(function(){updateHTML()},1e3)}),$(".tabs-control-panel li a").click(function(){setTimeout(function(){updateHTML()},300)}),$("#dump-container #fullscreen-option").click(function(){txtArea=jQuery(this).siblings(".is-active"),txtArea.toggleClass("fullscreen"),jQuery(this).toggleClass("absolute-fullscreen-option"),jQuery(this).toggleClass("fixed-fullscreen-option")}),$("#indexnav-main > a").click(function(){jQuery(this).hasClass("is-active")||($("#transactions").removeClass("hide"),$("#local").removeClass("hide"),$("#dataDump").addClass("hide"))}),$("#indexnav-more > a").click(function(){jQuery(this).hasClass("is-active")||($("#transactions").addClass("hide"),$("#local").addClass("hide"),$("#dataDump").removeClass("hide"))});var peerHashes=[""];$("body").on("mouseup","#peerList  #disconnect",function(a){queryState("disconnect",jQuery(this).attr("value"),function(a){obj=JSON.parse(a),"denied"==obj.Access?($("#"+obj.Id).find("#disconnect").addClass("disabled"),$("#"+obj.Id).find("#disconnect").text("Denied")):($("#"+obj.Id).find("#disconnect").addClass("disabled"),$("#"+obj.Id).find("#disconnect").text("Attempting"))})}),SortToggle=!0,PeerAddFromTopToggle=!0,$("#peer-duration").on("mouseup",function(a){$(".sorting-img").addClass("hide"),1==SortToggle?($("#peer-duration-sort-img").removeClass("hide"),$("#peer-duration-sort-img").attr("src","img/up.png")):($("#peer-duration-sort-img").removeClass("hide"),$("#peer-duration-sort-img").attr("src","img/down.png")),array=$("#peerList tbody tr").get(),valArray=$("#peerList tbody tr").find("#momentconnected").get(),array=generalSort(durationIsLessThan,array,valArray),$("#peerList tbody").html(array),PeerAddFromTopToggle=SortToggle}),$("#peer-ip").on("mouseup",function(a){$(".sorting-img").addClass("hide"),1==SortToggle?($("#peer-ip-sort-img").removeClass("hide"),$("#peer-ip-sort-img").attr("src","img/up.png")):($("#peer-ip-sort-img").removeClass("hide"),$("#peer-ip-sort-img").attr("src","img/down.png")),array=$("#peerList tbody tr").get(),valArray=$("#peerList tbody tr").find("#ip span").get(),array=generalSort(ipIsLessThan,array,valArray),$("#peerList tbody").html(array)}),$("#peer-sent").on("mouseup",function(a){$(".sorting-img").addClass("hide"),1==SortToggle?($("#peer-sent-sort-img").removeClass("hide"),$("#peer-sent-sort-img").attr("src","img/up.png")):($("#peer-sent-sort-img").removeClass("hide"),$("#peer-sent-sort-img").attr("src","img/down.png")),array=$("#peerList tbody tr").get(),valArray=$("#peerList tbody tr").find("#sent").get(),array=generalSort(msgIsLessThan,array,valArray),$("#peerList tbody").html(array),PeerAddFromTopToggle=SortToggle}),$("#peer-received").on("mouseup",function(a){$(".sorting-img").addClass("hide"),1==SortToggle?($("#peer-received-sort-img").removeClass("hide"),$("#peer-received-sort-img").attr("src","img/up.png")):($("#peer-received-sort-img").removeClass("hide"),$("#peer-received-sort-img").attr("src","img/down.png")),array=$("#peerList tbody tr").get(),valArray=$("#peerList tbody tr").find("#received").get(),array=generalSort(msgIsLessThan,array,valArray),$("#peerList tbody").html(array),PeerAddFromTopToggle=SortToggle});